C51 COMPILER V9.54   ONEWIRE                                                               08/11/2022 02:38:36 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE ONEWIRE
OBJECT MODULE PLACED IN .\Objects\OneWire.obj
COMPILER INVOKED BY: C:\Keil5\C51\BIN\C51.EXE OneWire.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\One
                    -Wire.lst) TABS(2) OBJECT(.\Objects\OneWire.obj)

line level    source

   1          #include <REGX52.H>
   2          
   3          sbit OneWire_DQ=P1^4;
   4          
   5          /**
   6            * @brief åˆå§‹åŒ–ï¼Œä¸»æœºæ‹‰ä½ä¸€æ®µæ—¶é—´(min: 480us, max: 960us)ï¼Œé‡Šæ”¾æ€»çº¿(15-60us)ï¼Œä»æœºæ‹‰
             -ä½ä½œä¸ºå“åº”(60-240us)
   7            * @param æ— 
   8            * @retval ä»æœºå“åº”: 0 æœ‰å“åº”ï¼Œ1 æ— å“åº”
   9            */
  10          unsigned char OneWire_Init(void)
  11          {
  12   1        unsigned char i;
  13   1        unsigned char Ack;
  14   1        EA=0;
  15   1        OneWire_DQ=1; // å‡†å¤‡å·¥ä½œï¼Œä¿è¯æ“ä½œå‰DQä¸ºé«˜ç”µå¹³
  16   1        OneWire_DQ=0; // æ‹‰ä½ç”µå¹³å¼€å§‹é€šä¿¡
  17   1        i = 249;while (--i);  // é€šè¿‡STCè®¡ç®—å‡ºçš„500uså»¶æ—¶
  18   1        OneWire_DQ=1; // é‡Šæ”¾æ€»çº¿ï¼Œå»¶æ—¶60usç­‰å¾…ç”µå¹³è‡ªåŠ¨ä¸Šæ‹‰ + 10us ä»æœºå“åº”
  19   1        i = 32;while (--i);
  20   1        Ack=OneWire_DQ; // è¯»å–å“åº”çŠ¶æ€
  21   1        i = 249;while (--i);  // å»¶æ—¶500usè·³è¿‡ä»æœºå“åº”çš„å‰©ä½™æ—¶é—´
  22   1        EA=1;
  23   1        return Ack; 
  24   1      }
  25          
  26          /**
  27            * @brief ä¸»æœºä¸‹æ‹‰å¼€å§‹é€šä¿¡ï¼Œä»æœºé‡‡æ ·çª—å£15-60usã€‚ä¸€ä¸ªå†™å‘¨æœŸè‡³å°‘ç»´æŒ60us, å‘¨æœŸä
             -¹‹é—´é—´éš”è‡³å°‘1us.
  28            * @param å‘é€çš„ç”µå¹³çŠ¶æ€
  29            * @retval æ— 
  30            */
  31          void OneWire_SendBit(unsigned char Bit)
  32          {
  33   1        unsigned char i;
  34   1        EA=0;
  35   1        OneWire_DQ=0; // å¼€å§‹é€šä¿¡
  36   1        i = 2;while (--i);// ç»´æŒ5us,ç„¶åè®¾ç½®è¦å‘é€çš„çŠ¶æ€
  37   1        OneWire_DQ=Bit;
  38   1        i = 29;while (--i);// å»¶æ—¶60usç­‰å¾…ä»æœºé‡‡æ ·ç»“æŸ
  39   1        OneWire_DQ=1; // ç»“æŸåé‡Šæ”¾æ€»çº¿
  40   1        EA=1;
  41   1      }
  42          
  43          /**
  44            * @brief ä¸»æœºä¸‹æ‹‰å¼€å§‹é€šä¿¡(ä¸èƒ½é•¿ï¼Œ1uså°±å¤Ÿäº†)ï¼Œé‡Šæ”¾æ€»çº¿ã€‚ä¸»æœºåœ¨15-60usä¹‹é—´é‡‡æ ·
             -ã€‚ä¸€ä¸ªå†™å‘¨æœŸè‡³å°‘ç»´æŒ60us, å‘¨æœŸä¹‹é—´é—´éš”è‡³å°‘1us.
  45            * @param æ— 
  46            * @retval æ— 
  47            */
  48          unsigned char OneWire_ReadBit(void)
  49          {
  50   1        unsigned char Bit,i;
  51   1        EA=0;
C51 COMPILER V9.54   ONEWIRE                                                               08/11/2022 02:38:36 PAGE 2   

  52   1        OneWire_DQ=0; // å¼€å§‹é€šä¿¡ï¼Œæ‰§è¡Œä¸€ä¸ªè¯­å¥å·²ç»è¾¾åˆ°1usçš„æ—¶é™äº†
  53   1        OneWire_DQ=1; // é‡Šæ”¾æ€»çº¿
  54   1        i = 7;while (--i);  // å»¶æ—¶15usåå¼€å§‹é‡‡æ ·
  55   1        Bit=OneWire_DQ;
  56   1        i = 22;while (--i);// å»¶æ—¶45usç­‰å¾…è¯»å‘¨æœŸå®Œæˆ
  57   1        OneWire_DQ=1; // ç»“æŸåé‡Šæ”¾æ€»çº¿
  58   1        EA=1;
  59   1        return Bit;
  60   1      }
  61          
  62          /**
  63            * @brief å†™å­—èŠ‚(8bit), ä½ä½å…ˆå†™
  64            * @param å†™å…¥çš„å­—èŠ‚
  65            * @retval æ— 
  66            */
  67          void OneWire_SendByte(unsigned char Byte)
  68          {
  69   1        unsigned char i;
  70   1        for(i=0;i<8;i++)
  71   1        {
  72   2          OneWire_SendBit(Byte&(0x01<<i));
  73   2        }
  74   1      }
  75          
  76          /**
  77            * @brief è¯»å­—èŠ‚(8bit), ä½ä½ä¼˜å…ˆ
  78            * @param æ— 
  79            * @retval è¯»å–çš„å­—èŠ‚
  80            */
  81          unsigned char OneWire_ReadByte(void)
  82          {
  83   1        unsigned char i,Byte=0x00;
  84   1        for(i=0;i<8;i++)
  85   1        {
  86   2      //    Data|=OneWire_ReadBit()<<i;
  87   2          if(OneWire_ReadBit()){Byte|=0x01<<i;}
  88   2        }
  89   1        return Byte;
  90   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    132    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
